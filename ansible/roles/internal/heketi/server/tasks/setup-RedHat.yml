---
- name: Install Heketi server package
  yum: 'name="{{ heketi_daemon_package }}"  state=present'

- name: Create a new ssh key
  shell: ssh-keygen -f "{{ heketi_ssh_private_key_file }}" -t rsa -N ''
  args:
    creates: "{{ heketi_ssh_private_key_file }}"

- name: Update key permissions
  file:
    path: "{{ item }}"
    owner: "{{ heketi_user }}"
    group: "{{ heketi_user }}"
  with_items:
    - "/etc/heketi/heketi_key"
    - "/etc/heketi/heketi_key.pub"

- name: Update Heketi config file
  template:
    src: heketi.json.j2
    dest: /etc/heketi/heketi.json
    owner: "root"
    group: "{{ heketi_user }}"
